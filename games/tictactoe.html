<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tic-Tac-Toe — Games</title>
  <link rel="stylesheet" href="../css/styles.css" />
</head>
<body class="game-page">
  <a class="home" href="../index.html">← Home</a>
  <div class="title">Tic-Tac-Toe</div>
  <div class="cookie-wrap" style="align-items:center;">
    <div id="ttt-board" style="display:grid; gap:12px; margin-bottom:18px;">
      <!-- cells will be generated by JS -->
    </div>
    <div style="display:flex; gap:12px; align-items:center; margin-bottom:10px;">
      <div id="ttt-status" style="font-size:18px; color:var(--accent); font-weight:700">Player X's turn</div>
      <label style="color:var(--muted); font-size:14px; display:flex; gap:6px; align-items:center"><input id="aiToggle" type="checkbox" /> Play vs AI</label>
    </div>
  <button id="ttt-restart" style="background:var(--btn-bg); color:var(--accent); border-radius:8px; padding:10px 18px; border:none; font-weight:800">Restart</button>
  </div>
  <div class="bloom" aria-hidden="true"></div>
  <script>
    const board = document.getElementById('ttt-board');
    const status = document.getElementById('ttt-status');
    const restart = document.getElementById('ttt-restart');
    const aiToggle = document.getElementById('aiToggle');
    let cells = Array(9).fill('');
    let turn = 'X';
    let gameOver = false;

    function render() {
      board.innerHTML = '';
      cells.forEach((cell, i) => {
        const btn = document.createElement('button');
        btn.textContent = cell;
        btn.style.cssText = 'width:80px;height:80px;font-size:2.2em;font-weight:800;background:linear-gradient(180deg,#04203a,#031428);color:' + (cell==='X'? '#60a5fa' : cell==='O'? '#f472b6' : '#fff') + ';border-radius:10px;box-shadow:0 4px 18px rgba(36,72,140,0.18);border:none;cursor:pointer;';
        btn.disabled = !!cell || gameOver;
        btn.addEventListener('click', () => playerMove(i));
        board.appendChild(btn);
      });
      // if it's AI's turn and AI enabled, let it move
      if (!gameOver && aiToggle.checked && turn === 'O') {
        // small delay to simulate thinking
        setTimeout(() => aiMove(), 300);
      }
    }

    function playerMove(i) {
      if (cells[i] || gameOver) return;
      cells[i] = turn;
      if (checkWin(turn, cells)) {
        status.textContent = `Player ${turn} wins!`;
        gameOver = true;
      } else if (cells.every(c => c)) {
        status.textContent = 'Draw!';
        gameOver = true;
      } else {
        turn = turn === 'X' ? 'O' : 'X';
        status.textContent = `Player ${turn}'s turn`;
      }
      render();
    }

    function aiMove() {
      if (gameOver) return;
      // AI plays as 'O'
      const idx = getBestMove(cells.slice(), 'O');
      if (idx === null || idx === undefined) return;
      cells[idx] = 'O';
      if (checkWin('O', cells)) {
        status.textContent = `Player O wins!`;
        gameOver = true;
      } else if (cells.every(c => c)) {
        status.textContent = 'Draw!';
        gameOver = true;
      } else {
        turn = 'X';
        status.textContent = `Player ${turn}'s turn`;
      }
      render();
    }

    function checkWin(p, boardArr) {
      const wins = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ];
      return wins.some(line => line.every(idx => boardArr[idx] === p));
    }

    // Minimax for optimal play. Returns best index for 'player' ('O' for AI)
    function getBestMove(boardArr, player) {
      // terminal checks
      function terminalScore(b, depth) {
        if (checkWin('O', b)) return 10 - depth;
        if (checkWin('X', b)) return -10 + depth;
        if (b.every(c => c)) return 0;
        return null;
      }

      function minimax(b, currentPlayer, depth) {
        const term = terminalScore(b, depth);
        if (term !== null) return term;
        if (currentPlayer === 'O') {
          let best = -Infinity;
          for (let i = 0; i < 9; i++) {
            if (!b[i]) {
              b[i] = 'O';
              const score = minimax(b, 'X', depth + 1);
              b[i] = '';
              best = Math.max(best, score);
            }
          }
          return best;
        } else {
          let best = Infinity;
          for (let i = 0; i < 9; i++) {
            if (!b[i]) {
              b[i] = 'X';
              const score = minimax(b, 'O', depth + 1);
              b[i] = '';
              best = Math.min(best, score);
            }
          }
          return best;
        }
      }

      let bestScore = -Infinity;
      let move = null;
      for (let i = 0; i < 9; i++) {
        if (!boardArr[i]) {
          boardArr[i] = player;
          const score = minimax(boardArr, player === 'O' ? 'X' : 'O', 0);
          boardArr[i] = '';
          if (score > bestScore) { bestScore = score; move = i; }
        }
      }
      return move;
    }

    restart.addEventListener('click', () => {
      cells = Array(9).fill('');
      turn = 'X';
      gameOver = false;
      status.textContent = `Player X's turn`;
      render();
    });

    aiToggle.addEventListener('change', () => {
      // if AI enabled and it's currently O's turn, let it move
      if (aiToggle.checked && turn === 'O' && !gameOver) setTimeout(() => aiMove(), 300);
    });

    render();
  </script>
</body>
</html>
